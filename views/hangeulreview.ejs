<%- include('partials/header') -%>
<main>
  <div class="overlay">
    <h2 id="correct" value=""></h2>
    <% for (let i = 0; i < 10; i++){ %>
    <div>
      <li class="col-6 justify-content-between mt-5">
        <span id=question<%= i %>></span>   
        <span id=check<%= i %>></span>
        <span id=correct<%= i %>></span>
      </li>
    </div>
    <% } %>
    <form action="/hangeul/result" enctype="multipart/form-data" method="POST">
              <div class="hide">
                  <label for="test">Test</label>
                  <textarea class="form-control" id="test" name="test"></textarea>
              </div>
              <div class="hide">
                  <label for="score">Score</label>
                  <textarea class="form-control correct" id="score" name="score"></textarea>
              </div>
              <button type="submit" class="btn btn-primary hide" id="pass" value="Upload">Submit</button>
      </form>
    <a id="fail" class="hangeulTest hide" href="/hangeul/test/<%= hangeul[0].section %>">Retake test</a>
  </div>
  <div class="container">
      <ul class="row list-unstyled">
        <% const hangeulKeys = Object.keys((hangeul[0].test)) %>
        <% for(let i=0; i<10; i++) {%>
          <% const selected = Math.ceil(Math.random()*hangeulKeys.length) %>
          <% let fourRandom = [] %>
          <% while(fourRandom.length <4) {%>
            <% const randomVal = Math.ceil(Math.random()*hangeulKeys.length) %>
            <% if(!fourRandom.includes(randomVal) && randomVal !== selected){fourRandom.push(randomVal)}}%>
            <% let fifth = Math.floor(Math.random()*5) %>
            <% fourRandom.splice(fifth, 0, selected) %>
          <li class="col-6 justify-content-between mt-5" value=<%= selected %> id=compare<%= i %>>   
            <span><%= hangeul[0].test[selected][0] %></span>
          </li>
            <label for="">Choose your answer:</label>
              <select id=answer<%= i %>>
            <% for(let j=0; j<fourRandom.length; j++){ %>
              <% let theVal = hangeul[0].test[fourRandom[j]][1]; %>
              <% let splitted = theVal.split(" ") %>
              <% let insertVal = splitted.join("_") %>
              <% if(j === 0){ %>
                <option value=<%= insertVal %> selected="selected"> <%= hangeul[0].test[fourRandom[j]][1] %> </a>
              <% } else { %>
              <option value=<%= insertVal %>> <%= hangeul[0].test[fourRandom[j]][1] %> </a>
              <% } %>
            <% } %>
          </select> 
          
        <% } %>
        </ul>
        <button onclick="grab()">Submit answers</button>
  </div>
  <script> 
  //grabbing data from the ejs and using it in js through stringify
  const hangeul = <%- JSON.stringify(hangeul[0].test) %>;
  const test = <%- JSON.stringify(hangeul[0].id) %>;
  const section = <%- JSON.stringify(hangeul[0].section) %>;
  const user = <%- JSON.stringify(user.id) %>;

  //getting keys to access the data
  const hangeulKeys = Object.keys(hangeul);
    console.log(hangeulKeys)
  //create the ten field 
    for(let i = 0; i < 10; i++){
      const selected = Math.ceil(Math.random()*hangeulKeys.length);
      let fourRandom = [];
    }



  //function to check if the answer is correct or not
    function grab(){
      //initialize array and number of correct answers to
      const selected = [];
      correct = 0;
      //loop through the answers and check if second value of the array in question is equal ++ else nothing
      for(let i = 0; i < 10; i++){
        const compare = document.getElementById(`compare${i}`).value;
        const optionVal = document.getElementById(`answer${i}`).value;
        const answer = optionVal.split("_").join(" ");
        document.querySelector(`#question${i}`).innerHTML = hangeul[compare][0];
        document.querySelector(`#check${i}`).innerHTML = `Selected: ${answer}`;
        document.querySelector(`#correct${i}`).innerHTML = `correct: ${hangeul[compare][1]}`;
        console.log(answer)
        if(hangeul[compare.toString()][1] === answer){
          selected.push(true);
          correct++;
        } else {
          selected.push(false)
        } 
      }
      //input all the values and if pass >= 60% show submit else retake
      const passFail = (correct/selected.length)*100;
      document.querySelector(".container").classList.add("hide");
      document.querySelector(".overlay").style.display = "block";
      document.querySelector("#correct").innerHTML = `Correct: ${passFail}%`
      document.querySelector("#correct").value = "check";
      document.getElementById("test").innerHTML = section;
      document.getElementById("score").innerHTML = passFail;
      document.querySelector(".correct").value = passFail;
      if(passFail >= 60){
        document.querySelector("#pass").classList.remove("hide");
      } else {
        document.querySelector("#fail").classList.remove("hide");
      }
    }
    </script>  
    </main>
<%- include('partials/footer') -%>